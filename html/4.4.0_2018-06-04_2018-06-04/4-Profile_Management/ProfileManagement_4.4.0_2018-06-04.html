<!DOCTYPE html>
<html lang="en">
<head>
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW" />
    <title>Device Enrollment Program</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Guide">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/TP40017387">
    <meta id="document-version" name="document-version" content="4.4.0">
    <meta id="build" name="build" content="88cf5dc7c61fb52e2f7c2588e505ee1d" />
    <meta id="chapterId" name="chapterId" content="TP40017387-CH7">
    <meta id="date" name="date" content="2018-06-04">
    <meta id="description" name="description" content="Describes how system administrators can send device
management commands to managed devices.">
    <meta id="book-title" name="book-title" content="Mobile Device Management Protocol Reference">
    <meta id="book-root" name="book-root" content="../">
    <meta id="book-json" name="book-json" content="../book.json">
    <meta id="devcenter" name="devcenter" content="Mac Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
    <meta id="reflib" name="reflib" content="Documentation Archive">
    <meta id="book-assignments" name="book-assignments" content="{Type/Guide}, {Topic/Data Management/Device Information}">
    
    
    <meta id="copyright" name="copyright" content="Copyright 2018 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Mobile Device Management Protocol Reference: Device Enrollment Program">
    <meta id="resources-uri" name="resources-uri" content="../../../../../Resources/1282">
    <link id="book-index-page" rel="Start" title="Mobile Device Management Protocol Reference" type="text/html" href="../index.html">
    <link id="next-page" rel="Next" type="text/html" href="../5-Web_Service_Protocol_VPP/webservice.html">
    <link id="previous-page" rel="Prev" type="text/html" href="../3-MDM_Protocol/MDM_Protocol.html">
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1282/CSS/screen.css">
    
    <!-- xcode_css -->
    <link rel="stylesheet" type="text/css" href="../../../../../Resources/1282/CSS/feedback.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta id="platforms" name="platforms" content="">
</head>    
<body><a name="//apple_ref/doc/uid/TP40017387-CH7" title="Device Enrollment Program"></a>
    <div id="_omniture_top">
    <!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
    <script type="text/javascript">
    /* RSID: */
    var s_account="appleglobal,appleusdeveloper,dappdeveloperlib"
    </script>

    <script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
    <script type="text/javascript">
    s.pageName=AC.Tracking.pageName();
    s.channel="www.us.developer"

    /************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
    var s_code=s.t();if(s_code)document.write(s_code)</script>
    <!-- End SiteCatalyst code version: H.8. -->
    </div>

    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode unified">
            <a id="ssi_LibraryTitle" href='../../../../../navigation/'>Documentation Archive</a>
            <a id="ssi_AppleDeveloperConnection" href='https://developer.apple.com/'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../../../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search Documentation Archive</label>
            
            
    
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>Mobile Device Management Protocol Reference</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main">
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../5-Web_Service_Protocol_VPP/webservice.html'>Next</a><a class='previousLink' rel='prev' href='../3-MDM_Protocol/MDM_Protocol.html'>Previous</a>
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="../index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/TP40017387-CH7-SW1" title="Device Enrollment Program"></a>
<h1 id="pageTitle">Device Enrollment Program</h1>
<p>In iOS 7 and later and macOS v10.9 and later, the Device Enrollment Program (DEP) helps to address the mass configuration needs of organizations purchasing and deploying devices in large quantities, without the need for factory customization or pre-configuration of devices prior to deployment. </p><p>In iOS 11 support for DEP devices that are not supervised was deprecated. In iOS 11 and later, DEP configured devices should always be supervised. And in a future release, the OS will ignore the DEP <code>is_supervised</code> flag completely.</p>
<div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW77" title="Note"></a><p><strong>Note:</strong>&nbsp;The Device Enrollment Program API is being upgraded to X-Server-Protocol-Version 2. X-Server-Protocol-Version 1 will continue to be supported as a default. The Web Services Header specified in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW6" data-renderer-version="1">Web Services</a></span> should be passed with all requests, because the default X-Server-Protocol-Version may change in the future.</p><p></p></aside></div>
<p>A device enrolled in the Device Enrollment Program prompts the user to enroll in MDM during the initial device setup process. Additionally, devices enrolled in the program can be supervised over the air. Although Apple’s servers store information about the device’s participation in this program, the MDM profile and login challenge are served by the organization’s server.</p>

<div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW76" title="Note"></a><p><strong>Note:</strong>&nbsp;
When the server makes a DEP request during the initial device setup process, the device is not yet enrolled and hence does not yet have a client certificate to present. At that time, engaging the device in additional security processes that require a certificate will cause an <code>NSURLErrorDomain</code> (-1012) error.</p><p></p></aside></div>

<p>The cloud service API provides profile management and mapping. With this API, you can obtain a list of devices, obtain information about those devices, and associate MDM enrollment profiles with those devices.</p>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW50" title="Device Management Workflow"></a><h2 class="jump">Device Management Workflow</h2><p>A typical MDM device management workflow contains the following steps:</p><ol class="ol"><li class="li"><p>Set up an account for your MDM server if you have not already done so.</p></li><li class="li"><p>Use the Fetch Devices endpoint to obtain devices associated with the MDM server’s account.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW67" title="Note"></a><p><strong>Note:</strong>&nbsp;Your server should periodically use the Sync Devices endpoint to obtain updated information about existing devices and new devices.</p><p></p></aside></div></li><li class="li"><p>Assign a profile to the device. You can do this in one of the following ways:</p><ul class="ul"><li class="li"><p>Use the Define Profile endpoint to create a new MDM server profile and associate it with one or more devices.</p></li><li class="li"><p>Use the Assign Profile endpoint to associate an existing MDM server profile with one or more devices.</p></li></ul></li><li class="li"><p>Remove the profile from the device when appropriate by using the Remove Profile endpoint.</p></li>



</ol></section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW68" title="DEP Server Tokens"></a><h2 class="jump">DEP Server Tokens</h2>
<p>The MDM Device Enrollment Program (DEP) uses a server token to allow an MDM server to securely connect to the DEP web service.</p>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW69" title="Obtaining a Server Token"></a><h3 class="jump">Obtaining a Server Token</h3>
<p>To obtain a DEP server token, the user must complete the steps outlined below. Your MDM server product can help by automating specific steps.</p>

<ol class="ol">
<li class="li"><p>Generate a public/private key pair in PEM format for the MDM server, and store the private key securely on the server.
</p></li>
<li class="li"><p>The user then must:</p>
<ol class="ol">
<li class="ol ol"><p>Sign into the Device Enrollment Program web portal.</p></li>
<li class="ol ol"><p>Create a new virtual MDM server.</p></li>
<li class="ol ol"><p>Upload a PEM-encoded X.509 certificate containing the PEM public key that was generated in Step 1.</p></li>
<li class="ol ol"><p>Download the S/MIME encrypted token file generated by the program web portal.</p></li>
</ol></li>
<li class="li"><p>Decrypt the S/MIME encrypted server token.</p></li>
<li class="li"><p>Upload the token file to the MDM server.</p></li>
</ol>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW70" title="Using DEP Server Tokens"></a><h3 class="jump">Using DEP Server Tokens</h3>
<p>DEP server tokens can be deployed either automatically or manually.</p>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW71" title="Automatically"></a><h4 class="jump">Automatically</h4>
<p>The MDM (physical) server must automatically decrypt this token file when it’s uploaded into the system, using the private key for the DEP web service.</p>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW72" title="Manually"></a><h4 class="jump">Manually</h4>
<p>Use the private key and provide an S/MIME encryption utility to manually decrypt the encrypted token file before it is uploaded to the MDM server. The MDM server then ingests a plain text token file for use with the DEP web service.</p>
</section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW74" title="Server Token Example"></a><h4 class="jump">Server Token Example</h4>
<p>Following is a S/MIME encrypted server token:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>Content-Type: application/pkcs7-mime; name="smime.p7m"; smime-type=enveloped-<span></span></pre></td></tr><tr><td scope="row"><pre>data<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Transfer-Encoding: base64<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Disposition: attachment; filename="smime.p7m"<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Description: S/MIME Encrypted Message<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>MIAGCSqGSIb3DQEHA6CAMIACAQAxggGeMIIBmgIBADCBgTB1MQswCQYDVQQGEwJVUzESMBAGA1UE<span></span></pre></td></tr><tr><td scope="row"><pre>ChMJWmlwcG8gSW5jMSgwJgYDVQQDEx9Qcm9maWxlIE1hbmFnZXIgUy9NSU1FIElkZW50aXR5MSgw<span></span></pre></td></tr><tr><td scope="row"><pre>JgYJKoZIhvcNAQkBFhlsb2NhbEB6aXBwb2luYzIuYXBwbGUuY29tAgiDS17MvQ95HDANBgkqhkiG<span></span></pre></td></tr><tr><td scope="row"><pre>9w0BAQEFAASCAQC/ukglifm8tk/OjyKBWwPbm+uDNHPG+sXLRrwfTlHKRo1jnvYrqKx1bRrpV/GR<span></span></pre></td></tr><tr><td scope="row"><pre>mN7WJPBZLOkFat+LoiEmrBUiUs3PnZ+U1FUAnHR66hnomKoX0JBgfuHBGYz9jeyiu1chQShgdOOe<span></span></pre></td></tr><tr><td scope="row"><pre>bYQdaFPJ/P57r98yQ2ZmyqcYOWwE0lOcqa77bfRab/YmMsMx2ZE1wUwnFPM71Yq3+vLIGLBRyvAb<span></span></pre></td></tr><tr><td scope="row"><pre>4pBxDlRtgGbxs+2gZwEe0MZ4tx/97RGnZbkJt/26v5P4njGiyCvq2hZUwbria7THhMEvmJRjpZNZ<span></span></pre></td></tr><tr><td scope="row"><pre>x5BfTjU8a0EHwvvwnYb67LRnjoSMn/JgelRP70O9fhdZ5Y56xhs6MIAGCSqGSIb3DQEHATAdBglg<span></span></pre></td></tr><tr><td scope="row"><pre>hkgBZQMEAQIEEF5d7PQ1O8lxOLjSwjNHwFaggASCAeC9GWg9EDLpyO2g6eoOmeIVYXbWXrRt4JRY<span></span></pre></td></tr><tr><td scope="row"><pre>TqCB2dWDqc9BJqOYuX5lnULjvkJ8btlBfAMhUXUb/lFF5xNXGxLTtVHvyVK9FUyhikJFweRohWqM<span></span></pre></td></tr><tr><td scope="row"><pre>/xtu+7/1rPT9Nmlssla9wcTAh8GsWbs9ZyM7Pnok+o1XOwRLgh1dGvW8EGxlaPWjcHolleFBStV6<span></span></pre></td></tr><tr><td scope="row"><pre>lGKJUrUyzgyBvSWo/6Y/Ojb/kfzq/kzS6H7h4YZI69/Js604rpOL6FAeOwKaJLISfUUp/yNHMBr6<span></span></pre></td></tr><tr><td scope="row"><pre>wj772MNnoIdVEQs14/Fk+XVDb4xghD1zzeDow+eseb+qEfY7FkgYi2jpdebk9X4BpJ1WGvy4WiA8<span></span></pre></td></tr><tr><td scope="row"><pre>biyKpst6zJb0jdJ4TE0zyIcjuVeOXuV/cD1c7YrYQty1Sh3nBsjFwVOsHq33YjapcHf2wuhXW+hh<span></span></pre></td></tr><tr><td scope="row"><pre>HNzpkyMKrNcsEK1HpJva2O6vBtxtYZIn5/4kGDeALUiXxVjtvio1gS37lry5YKEwhYJ+cKKe3exZ<span></span></pre></td></tr><tr><td scope="row"><pre>xhLfD67AINahDm868kEuKuHIl8gku+gSKAWlUVGNrPNt/M2rM+y4+4cm23R2f3VXYuNncnFFbulF<span></span></pre></td></tr><tr><td scope="row"><pre>7VQuGd3wwtKncIACU5rze4b366rRBG1PCvB7abuRcmw9UrgzkRlH8tbOhORZ0Dgimd5knujsbKMA<span></span></pre></td></tr><tr><td scope="row"><pre>AAAAAAAAAAAA<span></span></pre></td></tr></table></div>
<p>Following is the decrypted server token in plain text:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>Content-Type: text/plain;charset=UTF-8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Transfer-Encoding: 7bit<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{"consumer_key":"CK_9dcd8190dde27dfddd9272c657e011f7bec9761676b1b11e46a2f61d3c<span></span></pre></td></tr><tr><td scope="row"><pre>b1e482ef22093c7d54b23252f3bdb4d19b4d49","consumer_secret":"CS_27c083df1ab7271e<span></span></pre></td></tr><tr><td scope="row"><pre>129cb23325dabaf0de95d087","access_token":"AT_O365587095O8247e0b5288abcdee25642<span></span></pre></td></tr><tr><td scope="row"><pre>311746d67b5858ea5cO1389734861908","access_secret":"AS_8c3313de9a3462014c6c96f3<span></span></pre></td></tr><tr><td scope="row"><pre>9dd7c3d4342b8cea","access_token_expiry":"2015-01-14T21:27:41Z"}<span></span></pre></td></tr></table></div>
</section>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW2" title="Authentication and Authorization"></a><h3 class="jump">Authentication and Authorization</h3><p>To obtain OAuth access credentials for a server, download a server token file while the server is being created on the portal. The token file contains a JSON object similar to the one shown below:</p><div class="codesample clear"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  "consumer_key": "CK_00fadb3d36c6094cf479838455321b7c",<span></span></pre></td></tr><tr><td scope="row"><pre>  "consumer_secret": "CS_5fb17e5676db0cf875211937e5166d0f662ea1f9",<span></span></pre></td></tr><tr><td scope="row"><pre>  "access_token": "AT_O2109279022Oe03b641fd6f07d7face7894211d521fd8bef09c3O137392",<span></span></pre></td></tr><tr><td scope="row"><pre>  "access_secret": "AS_837c228d968ff303837086a5a54be645314ef755"<span></span></pre></td></tr><tr><td scope="row"><pre>  "access_token_expiry": "2013-09-09T02:24:28Z"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Each service request to the MDM enrollment service must include an <code>X-ADM-Auth-Session</code> header.</p><p>If the request does not have a valid <code>X-ADM-Auth-Session</code> header, or the auth token has expired, the server returns an HTTP <code>401 Unauthorized</code> error.</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 401 Unauthorized<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain;Charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 9<span></span></pre></td></tr><tr><td scope="row"><pre>WWW-Authenticate: ADM-Auth-Token<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 31 May 2012 21:23:37 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>UNAUTHORIZED<span></span></pre></td></tr></table></div><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW3" title="Requesting a New Session Authorization Token"></a><h4 class="jump">Requesting a New Session Authorization Token</h4><p>A new <code>X-ADM-Auth-Session</code> can be requested by using the <span class="content_text"><a href="https://configbuddy.apple.com/session" class="urlLink" rel="external">https://mdmenrollment.apple.com/session</a></span> endpoint. This endpoint supports the OAuth 1.0a protocol for accessing protected resources. When you sign up for the Device Enrollment Program, your server is assigned four pieces of information:</p><ul class="ul"><li class="li"><p>consumer_key</p></li><li class="li"><p>consumer_secret</p></li><li class="li"><p>access_token</p></li><li class="li"><p>access_secret</p></li></ul><p>Your OAuth request must provide these pieces of information along with a timestamp (in seconds since January 1, 1970 00:00:00 GMT) and a cryptographically random nonce that must be unique for all requests made with a given timestamp. The server’s time should be synchronized using time.apple.com or another trusted NTP provider.</p><p>The request must be signed using HMAC-SHA1, as described in <span class="content_text"><a href="http://oauth.net/" class="urlLink" rel="external">http://oauth.net/core/1.0a/#signing_process</a></span>.</p><p>For example:</p><div class="codesample clear"><table><tr><td scope="row"><pre>GET /session HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>Authorization: OAuth realm="ADM",<span></span></pre></td></tr><tr><td scope="row"><pre>       oauth_consumer_key="CK_00fadb3d36c6094cf479838455321b7c",<span></span></pre></td></tr><tr><td scope="row"><pre>       oauth_token="AT_O2109279022Oe03b641fd6f07d7face7894211d521fd8bef09c3O137392",<span></span></pre></td></tr><tr><td scope="row"><pre>       oauth_signature_method="HMAC-SHA1",<span></span></pre></td></tr><tr><td scope="row"><pre>       oauth_signature="wOJIO9A2W5mFwDgiDvZbTSMK%2FPY%3D",<span></span></pre></td></tr><tr><td scope="row"><pre>       oauth_timestamp="137131200",<span></span></pre></td></tr><tr><td scope="row"><pre>       oauth_nonce="4572616e48616d6d65724c61686176",<span></span></pre></td></tr><tr><td scope="row"><pre>       oauth_version="1.0"<span></span></pre></td></tr></table></div><p>For more information about the OAuth specification, see <span class="content_text"><a href="http://oauth.net/" class="urlLink" rel="external">http://oauth.net/core/1.0a/</a></span>.</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW4" title="Response Payload"></a><h4 class="jump">Response Payload</h4><p>The token service validates the request and replies with a JSON payload containing a single key, <code>auth_session_token</code>, that contains the new <code>X-ADM-Auth-Session</code> token. For example:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 28 Feb 2013 02:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 47<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "auth_session_token" : "87a235815b8d6661ac73329f75815b8d6661ac73329f815"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW8" title="Note"></a><p><strong>Note:</strong>&nbsp;The Device Enrollment Program service periodically issues a new <code>X-ADM-Auth-Session</code> in its response to a service call; the MDM server can use this new header value for any subsequent calls.</p><p></p></aside></div><p>After a period of time, this token expires, and the service returns a <code>401</code> error code. At this point, the MDM server must obtain a new session token from the <span class="content_text"><a href="https://configbuddy.apple.com/session" class="urlLink" rel="external">https://mdmenrollment.apple.com/session</a></span> endpoint.</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW7" title="Authentication Error Codes"></a><h4 class="jump">Authentication Error Codes</h4><p>An authentication error commonly results in either a <code>400</code>, <code>401</code>, or <code>403</code> error code.</p><p>An HTTP <code>400 Bad Request</code> error indicates one of the following:</p><ul class="simple"><li><p>Unsupported oauth parameters</p></li><li><p>Unsupported signature method</p></li><li><p>Missing required authorization parameter</p></li><li><p>Duplicated OAuth protocol parameter</p></li></ul><p>An HTTP <code>401 Unauthorized</code> error indicates one of the following:</p><ul class="simple"><li><p>Invalid consumer key</p></li><li><p>Invalid or expired token</p></li><li><p>Invalid signature</p></li><li><p>Invalid or already-used nonce</p></li></ul><p>An HTTP <code>403 Forbidden</code> error indicates one of the following:</p><ul class="simple"><li><p>The MDM server does not have access to perform the specific request or the MDM server’s consumer key or token does not have authorization to perform the specific request. In this case, the request body contains <code>ACCESS_DENIED</code>.</p></li><li><p>The organization has not accepted latest Terms and Conditions of the program. In this case, the request body contains <code>T_C_NOT_SIGNED</code>.</p></li></ul><p>For example, the following is the response when the MDM server is not authorized to perform a given request.</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 403 Forbidden<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain;Charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 13<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 31 May 2012 21:23:57 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ACCESS_DENIED<span></span></pre></td></tr></table></div></section></section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW6" title="Web Services"></a><h3 class="jump">Web Services</h3><p>This section lists the services that Apple’s servers provide to your MDM server. Except where otherwise specified, all requests must be sent with the following HTTP headers:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Header</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>User-Agent</code></p></td><td ><p>Your MDM server’s user agent string.</p></td></tr><tr><td  scope="row"><p><code>X-Server-Protocol-Version</code></p></td><td ><p>1, 2, or 3.</p></td></tr><tr><td  scope="row"><p><code>X-ADM-Auth-Session</code></p></td><td ><p>An authentication token value.</p><p>This header may be omitted when requesting an authentication token.</p></td></tr><tr><td  scope="row"><p><code>Content-Type</code></p></td><td ><p><code>application/json;charset=UTF8</code></p><p>This header may be omitted for requests that do not include a request body.</p></td></tr></table></div>
<div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW75" title="Note"></a><p><strong>Note:</strong>&nbsp;
Apple servers now run X-Server-Protocol-Version 2, which may include additional keys in the response body. Clients running X-Server-Protocol-Version 1 should be programmed to ignore these keys.</p><p></p></aside></div>
<p>For example:</p><div class="codesample clear"><table><tr><td scope="row"><pre>GET /account HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent: ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr></table></div><p>The sections below describe the available commands.</p><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW9" title="Account Details"></a><h4 class="jump">Account Details</h4><p>Each MDM server must be registered with Apple. This endpoint provides details about the server entity to identify it uniquely throughout your organization. Each server can be identified by either its system-generated UUID or by a user-provided name assigned by one of the organization’s users. Both the UUID and server name must be unique within your organization.</p><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW10" title="URL"></a><h5 class="jump">URL</h5><p><code>https://mdmenrollment.apple.com/account</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW11" title="Query Type"></a><h5 class="jump">Query Type</h5><p>GET</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW12" title="Request Body"></a><h5 class="jump">Request Body</h5><p>This request does not require a request body.</p><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>GET /account HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent: ProfileManager-1.9<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:3<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr></table></div></section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW13" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p>

<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>server_name</code></p></td><td ><p>An identifiable name for the MDM server.</p></td></tr><tr><td  scope="row"><p><code>server_uuid</code></p></td><td ><p>A system-generated server identifier.</p></td></tr>
<tr><td  scope="row"><p><code>admin_id</code></p></td><td ><p>Apple ID of the person who generated the current tokens that are in use.</p></td></tr>
<tr><td  scope="row"><p><code>facilitator_id</code></p></td><td ><p>Legacy equivalent to the <code>admin_id</code> key. <strong>This key is deprecated and may not be returned in future responses.</strong></p></td></tr>
<tr><td  scope="row"><p><code>org_name</code></p></td><td ><p>The organization name.</p></td></tr><tr><td  scope="row"><p><code>org_email</code></p></td><td ><p>The organization email address.</p></td></tr><tr><td  scope="row"><p><code>org_phone</code></p></td><td ><p>The organization phone.</p></td></tr>
<tr><td  scope="row"><p><code>org_address</code></p></td><td ><p>The organization address.</p></td></tr>

<tr><td  scope="row"><p><code>urls</code></p></td><td ><p>The list of dictionaries (see below) containing URLs available in MDM service. This key is valid in X-Server-Protocol-Version 3 and later.</p></td></tr>

<tr><td  scope="row"><p><code>org_type</code></p></td><td ><p>Possible values: <code>edu</code> or <code>org</code>. This key is available only in protocol version 3 and later.</p></td></tr>

<tr><td  scope="row"><p><code>org_version</code></p></td><td ><p>Possible values: <code>v1</code> or <code>v2</code>. <code>v1</code> is for ADP organizations and <code>v2</code> is for ASM organizations. Currently <code>v2</code> is applicable only to educational organizations. This key is available only in protocol version 3 and later.</p></td></tr><tr><td  scope="row"><p><code>org_id</code></p></td><td ><p>DEP customer ID. This key is available only in protocol version 3 and later.</p></td></tr><tr><td  scope="row"><p><code>org_id_hash</code></p></td><td ><p>Returns the SHA hash of an org identifier. This helps MDMs match it with the <code>organizationIdHash</code> key in the <code>VPPClientConfigSrv</code> API. This key is available only in protocol version 3 and later.</p></td></tr>
</table></div>

<p>Each <code>url</code> dictionary contains the following keys:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr>
<tr><td  scope="row"><p><code>uri</code></p></td><td ><p>URI for the API.</p></td></tr>
<tr><td  scope="row"><p><code>http_method</code></p></td><td ><p>Possible values: GET, POST, PUT, DELETE.</p></td></tr>
<tr><td  scope="row"><p><code>limit</code></p></td><td ><p>Optional: Dictionary for limit parameter (see below).</p></td></tr>
</table></div>

<p>Each <code>limit</code> dictionary contains the following keys:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr>
<tr><td  scope="row"><p><code>default</code></p></td><td ><p>Default value of limit.</p></td></tr>
<tr><td  scope="row"><p><code>maximum</code></p></td><td ><p>Maximum value of limit.</p></td></tr>
</table></div>

<p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 28 Feb 2013 02:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 640<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version: 3<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>     "server_name" : "IT Department Server",<span></span></pre></td></tr><tr><td scope="row"><pre>     "server_uuid" : "677cab70-fe18-11e2-b778-0800200c9a66",<span></span></pre></td></tr><tr><td scope="row"><pre>     "admin_id" : "facilitator1@example.com",<span></span></pre></td></tr><tr><td scope="row"><pre>     "facilitator_id" : "facilitator1@example.com",<span></span></pre></td></tr><tr><td scope="row"><pre>     "org_name" : "Sample Inc",<span></span></pre></td></tr><tr><td scope="row"><pre>     "org_phone" : "111-222-3333",<span></span></pre></td></tr><tr><td scope="row"><pre>     "org_email" : "orgadmin@example.com",<span></span></pre></td></tr><tr><td scope="row"><pre>     "org_address": "12 Infinite Loop, Cupertino, California 95014",<span></span></pre></td></tr><tr><td scope="row"><pre>     "urls" : [<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/account","http_method":["GET"]},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/server/devices","http_method":["POST"],<span></span></pre></td></tr><tr><td scope="row"><pre>         "limit":{"default":100,"maximum":1000}},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/devices/sync","http_method":["POST"]},<span></span></pre></td></tr><tr><td scope="row"><pre>         "limit":{"default":100,"maximum":1000}},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/devices","http_method":["POST"]},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/devices/disown","http_method":["POST"]},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/profile","http_method":["POST"]},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/profile/devices","http_method":["POST"]},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/profile","http_method":["POST"]},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/profile/devices","http_method":["GET"]},<span></span></pre></td></tr><tr><td scope="row"><pre>       {"uri":"/profile/devices","http_method":["DELETE"]},<span></span></pre></td></tr><tr><td scope="row"><pre>     ],<span></span></pre></td></tr><tr><td scope="row"><pre>     "org_type":"edu",<span></span></pre></td></tr><tr><td scope="row"><pre>     "org_version":"v2"<span></span></pre></td></tr><tr><td scope="row"><pre>     "org_id":"8938930387878",<span></span></pre></td></tr><tr><td scope="row"><pre>      "org_id_hash":"987559fe5f1ac383ed8ffffaa7699f80f178472f3d697104727d7c5314159d64"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
</section>
</section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW16" title="Fetch Devices"></a><h4 class="jump">Fetch Devices</h4><p>This request fetches a list of all devices that are assigned to this MDM server at the time of the request. This service should be used for loading an initial list of devices into the MDM server’s data store. Once the list of devices is loaded, device sync requests should be used to synchronize the list with any further changes.</p><p>This request provides a limited number of entries per request, using cursors to provide position information across requests.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW17" title="Note"></a><p><strong>Note:</strong>&nbsp;The server accepts only the <code>application/json</code> content type for this request.</p><p></p></aside></div>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW18" title="URL"></a><h5 class="jump">URL</h5><p><code>https://mdmenrollment.apple.com/server/devices</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW19" title="Query Type"></a><h5 class="jump">Query Type</h5><p>POST</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW20" title="Request Body"></a><h5 class="jump">Request Body</h5><p>The request body should contain a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>cursor</code></p></td><td ><p>Optional. A hex string that represents the starting position for a request. This is used for retrieving the list of devices that have been added or removed since a previous request. On the initial request, this should be omitted.</p></td></tr><tr><td  scope="row"><p><code>limit</code></p></td><td ><p>Optional. The maximum number of entries to return. The default value is 100, and the maximum value is 1000.</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>POST /server/devices HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.9<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>"limit": 100,<span></span></pre></td></tr><tr><td scope="row"><pre>"cursor": "1ac73329f75815"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW21" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>cursor</code></p></td><td ><p>Indicates when this request was processed by the enrollment server. The MDM server can use this value in future requests if it wants to retrieve only records added or removed since this request.</p></td></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>An array of dictionaries providing information about devices, sorted in chronological order of enrollment from oldest to most recent.</p></td></tr><tr><td  scope="row"><p><code>fetched_until</code></p></td><td ><p>A timestamp indicating the progress of the device fetch request, in ISO 8601 format.</p></td></tr><tr><td  scope="row"><p><code>more_to_follow</code></p></td><td ><p>A Boolean value that indicates whether the request’s limit and cursor values resulted in only a partial list of devices. If <code>true</code>, the MDM server should then make another request (starting from the newly returned cursor) to obtain additional records.</p></td></tr></table></div><p>Each device dictionary contains the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>serial_number</code></p></td><td ><p>The device’s serial number (string).</p></td></tr><tr><td  scope="row"><p><code>model</code></p></td><td ><p>The model name (string).</p></td></tr><tr><td  scope="row"><p><code>description</code></p></td><td ><p>A description of the device (string).</p></td></tr><tr><td  scope="row"><p><code>color</code></p></td><td ><p>The color of the device (string).</p></td></tr><tr><td  scope="row"><p><code>asset_tag</code></p></td><td ><p>The device’s asset tag (string), if provided by Apple.</p></td></tr><tr><td  scope="row"><p><code>profile_status</code></p></td><td ><p>The status of profile installation—either <code>"empty"</code>, <code>"assigned"</code>, <code>"pushed"</code>, or <code>"removed"</code>.</p></td></tr><tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>The unique ID of the assigned profile.</p></td></tr><tr><td  scope="row"><p><code>profile_assign_time</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when a profile was assigned to the device. If a profile has not been assigned, this field may be absent.</p></td></tr><tr><td  scope="row"><p><code>profile_push_time</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when a profile was pushed to the device. If a profile has not been pushed, this field may be absent.</p></td></tr>

<tr><td  scope="row"><p><code>device_assigned_date</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when the device was enrolled in the Device Enrollment Program.</p></td></tr>

<tr><td  scope="row"><p><code>device_assigned_by</code></p></td><td ><p>The email of the person who assigned the device.</p></td></tr>

<tr><td  scope="row"><p><code>os</code></p></td><td ><p>The device’s operating system: <code>iOS</code>, <code>OSX</code>, or <code>tvOS</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>device_family</code></p></td><td ><p>The device’s Apple product family: <code>iPad</code>, <code>iPhone</code>, <code>iPod</code>, <code>Mac</code>, or <code>AppleTV</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

</table></div><p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 02:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 640<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>       "devices" : [<span></span></pre></td></tr><tr><td scope="row"><pre>             {<span></span></pre></td></tr><tr><td scope="row"><pre>                 "serial_number" : "C8TJ500QF1MN",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "model" : "IPAD",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "description" : "IPAD WI-FI 16GB",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "color" : "black",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "asset_tag" : "304214",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "profile_status" : "empty",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "device_assigned_date" : "2013-04-05T14:30:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "device_assigned_by" : "facilitator1@sampleinc.com",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "os" : "iOS",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "device_family" : "iPad"<span></span></pre></td></tr><tr><td scope="row"><pre>             },<span></span></pre></td></tr><tr><td scope="row"><pre>             {<span></span></pre></td></tr><tr><td scope="row"><pre>                 "serial_number" : "C8TJ500QF1MN",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "model" : "IPAD",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "description" : "IPAD WI-FI 16GB",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "color" : "white",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "profile_status" : "assigned",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "profile_uuid" : "88fc4e378fea4021a94b2d7268fbf767",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "profile_assign_time" : "2013-05-01T00:00:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "device_assigned_date" : "2013-04-05T15:30:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "device_assigned_by" : "facilitator1@sampleinc.com",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "os" : "iOS",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "device_family" : "iPad"<span></span></pre></td></tr><tr><td scope="row"><pre>             }<span></span></pre></td></tr><tr><td scope="row"><pre>       ]<span></span></pre></td></tr><tr><td scope="row"><pre>       "fetched_until" : "2013-05-09T02:24:28Z",<span></span></pre></td></tr><tr><td scope="row"><pre>       "cursor" : "1ac73329f75815",<span></span></pre></td></tr><tr><td scope="row"><pre>       "more_to_follow" : "false"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW22" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>400</code> error with <code>INVALID_CURSOR</code> in the response body indicates that an invalid cursor value was provided.</p></li><li class="li"><p>A <code>400</code> error with <code>EXHAUSTED_CURSOR</code> in the response body indicates that the cursor had returned all devices in previous calls.</p></li></ul></section></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW14" title="Sync Devices"></a><h4 class="jump">Sync Devices</h4><p>The sync service depends on a cursor returned by the fetch device service. It returns a list of all modifications (additions or deletions) since the specified cursor. The cursor passed to this endpoint should not be older than 7 days.</p><p>This service may return the same device more than once. You must resolve duplicates by matching on the device serial number and the <code>op_type</code> and <code>op_date</code> fields.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW15" title="Note"></a><p><strong>Note:</strong>&nbsp;The server accepts only the <code>application/json</code> content type for this request.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW48" title="URL"></a><h5 class="jump">URL</h5><p><code>https://mdmenrollment.apple.com/devices/sync</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW49" title="Query Type"></a><h5 class="jump">Query Type</h5><p>POST</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW51" title="Request Body"></a><h5 class="jump">Request Body</h5><p>The request body should contain a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>cursor</code></p></td><td ><p>A hex string returned by a previous request that represents the starting position for a request.</p><p>The request returns results that describe any changes or additions to devices that happened after this starting position.</p></td></tr><tr><td  scope="row"><p><code>limit</code></p></td><td ><p>Optional. The maximum number of entries to return. The default value is 100, and the maximum value is 1000.</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>POST /devices/sync HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.9<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 50<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "cursor": "1ac73329f75815",<span></span></pre></td></tr><tr><td scope="row"><pre>    "limit" : 200<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW52" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>cursor</code></p></td><td ><p>Indicates when this request was processed by the server. The MDM server can use this value in future requests if it wants to retrieve only records added or removed since this request.</p></td></tr><tr><td  scope="row"><p><code>more_to_follow</code></p></td><td ><p>Indicates that the request’s limit and cursor values resulted in only a partial list of devices. The MDM server should immediately make another request (starting from the newly returned cursor) to obtain additional records.</p></td></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>An array of dictionaries providing information about devices, sorted in chronological order by the time stamp of the operation performed on the device.</p></td></tr><tr><td  scope="row"><p><code>fetched_until</code></p></td><td ><p>A date stamp indicating the progress of the device fetch request, in ISO 8601 format.</p></td></tr></table></div><p>Each device dictionary contains some of the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>serial_number</code></p></td><td ><p>The device’s serial number (string).</p></td></tr><tr><td  scope="row"><p><code>model</code></p></td><td ><p>The model name (string).</p></td></tr><tr><td  scope="row"><p><code>description</code></p></td><td ><p>A description of the device (string).</p></td></tr><tr><td  scope="row"><p><code>color</code></p></td><td ><p>The color of the device (string).</p></td></tr><tr><td  scope="row"><p><code>asset_tag</code></p></td><td ><p>The device’s asset tag (string).</p></td></tr><tr><td  scope="row"><p><code>profile_status</code></p></td><td ><p>The status of profile installation—either <code>"empty"</code>, <code>"assigned"</code>, <code>"pushed"</code>, or <code>"removed"</code>.</p></td></tr><tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>The unique ID of the assigned profile.</p></td></tr><tr><td  scope="row"><p><code>profile_assign_time</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when a profile was assigned to the device.</p></td></tr><tr><td  scope="row"><p><code>profile_push_time</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when a profile was pushed to the device.</p></td></tr><tr><td  scope="row"><p><code>op_type</code></p></td><td ><p>Indicates whether the device was added (assigned to the MDM server), modified, or deleted. Contains one of the following strings: <code>added</code>, <code>modified</code>, or <code>deleted</code>.</p></td></tr>

<tr><td  scope="row"><p><code>op_date</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when the device was added, updated, or deleted. If the value of <code>op_type</code> is <code>added</code>, this is the same as <code>device_assigned_date</code>.</p></td></tr>
<tr><td  scope="row"><p><code>device_assigned_by</code></p></td><td ><p>The email of the person who assigned the device.</p></td></tr>
<tr><td  scope="row"><p><code>device_assigned_date</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when the device was assigned to the MDM server.</p></td></tr>

<tr><td  scope="row"><p><code>os</code></p></td><td ><p>The device’s operating system: <code>iOS</code>, <code>OSX</code>, or <code>tvOS</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>device_family</code></p></td><td ><p>The device’s Apple product family: <code>iPad</code>, <code>iPhone</code>, <code>iPod</code>, <code>Mac</code>, or <code>AppleTV</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

</table></div>
<p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 03:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 640<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        "devices" : [<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    "serial_number" : "C8TJ500QF1MN",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "model" : "IPAD",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "color" :    "black",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "description" : "IPAD WI-FI 16GB",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "asset_tag" : "304214",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "profile_status" : "empty",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "op_type" : "added",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "op_date" : "2013-05-09T14:30:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "device_assigned_by" : "facilitator1@sampleinc.com",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "device_assigned_date" : "2013-05-09T14:30:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "os" : "iOS",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "device_family" : "iPad"<span></span></pre></td></tr><tr><td scope="row"><pre>                },<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    "serial_number" : "C8TJ500QF1MN",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "model" : "IPAD",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "color" :    "white",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "description" : "IPAD WI-FI 16GB",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "op_type" : "deleted",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "op_date" : "2013-05-09T14:30:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "device_assigned_by" : "facilitator1@sampleinc.com",<span></span></pre></td></tr><tr><td scope="row"><pre>                    "device_assigned_date" : "2013-05-09T14:30:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "os" : "iOS",<span></span></pre></td></tr><tr><td scope="row"><pre>                 "device_family" : "iPad"<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            ],<span></span></pre></td></tr><tr><td scope="row"><pre>        "more_to_follow" : false,<span></span></pre></td></tr><tr><td scope="row"><pre>        "cursor" : "2ac73329f75815"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW53" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>400</code> error with <code>CURSOR_REQUIRED</code> in the response body indicates that no cursor value was provided.</p></li><li class="li"><p>A <code>400</code> error with <code>INVALID_CURSOR</code> in the response body indicates that an invalid cursor value was provided.</p></li><li class="li"><p>A <code>400</code> error with <code>EXPIRED_CURSOR</code> in the response body indicates that the provided cursor is older than 7 days.</p></li></ul></section></section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW23" title="Device Details"></a><h4 class="jump">Device Details</h4><p>Returns information about an array of devices.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW24" title="Note"></a><p><strong>Note:</strong>&nbsp;The server accepts only the <code>application/json</code> content type for this request.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW25" title="URL"></a><h5 class="jump">URL</h5><p><code>https://mdmenrollment.apple.com/devices</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW26" title="Query Type"></a><h5 class="jump">Query Type</h5><p>POST</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW27" title="Request Body"></a><h5 class="jump">Request Body</h5><p>The request body should contain a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>An array of strings containing device serial numbers.</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>POST /devices HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices":["C8TJ500QF1MN", "B7CJ500QF1MA"]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW28" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary of dictionaries. The outer dictionary keys are the serial numbers from the original request. Each value is a dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>response_status</code></p></td><td ><p>A string indicating whether a particular device’s data could be retrieved—either <code>SUCCESS</code> or <code>NOT_FOUND</code>.</p></td></tr>
<tr><td  scope="row"><p><code>os</code></p></td><td ><p>The device’s operating system: <code>iOS</code>, <code>OSX</code>, or <code>tvOS</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>device_family</code></p></td><td ><p>The device’s Apple product family: <code>iPad</code>, <code>iPhone</code>, <code>iPod</code>, <code>Mac</code>, or <code>AppleTV</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>serial_number</code></p></td><td ><p>The device’s serial number (string).</p></td></tr>

<tr><td  scope="row"><p><code>model</code></p></td><td ><p>The model name (string).</p></td></tr>

<tr><td  scope="row"><p><code>description</code></p></td><td ><p>A description of the device (string).</p></td></tr><tr><td  scope="row"><p><code>color</code></p></td><td ><p>The color of the device (string).</p></td></tr><tr><td  scope="row"><p><code>asset_tag</code></p></td><td ><p>The device’s asset tag (string).</p></td></tr><tr><td  scope="row"><p><code>device_assigned_by</code></p></td><td ><p>The email of the person who assigned the device.</p></td></tr><tr><td  scope="row"><p><code>device_assigned_date</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when the device was assigned to the MDM server.</p></td></tr>
<tr><td  scope="row"><p><code>profile_status</code></p></td><td ><p>The status of profile installation: either <code>empty</code>, <code>assigned</code>, <code>pushed</code>, or <code>removed</code>. If <code>empty</code>, no other profile fields are present.</p></td></tr><tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>The unique ID of the assigned profile.</p></td></tr><tr><td  scope="row"><p><code>profile_assign_time</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when a profile was assigned to the device.</p></td></tr><tr><td  scope="row"><p><code>profile_push_time</code></p></td><td ><p>A time stamp in ISO 8601 format indicating when a profile was pushed to the device.</p></td></tr></table></div><p>For example, the server might send a response that looks like this:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 03:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 259<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  "devices":<span></span></pre></td></tr><tr><td scope="row"><pre>  {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>      "C8TJ500QF1MN" :<span></span></pre></td></tr><tr><td scope="row"><pre>      {<span></span></pre></td></tr><tr><td scope="row"><pre>        "response_status" : "SUCCESS",<span></span></pre></td></tr><tr><td scope="row"><pre>        "os" : "iOS",<span></span></pre></td></tr><tr><td scope="row"><pre>        "device_family" : "iPad",<span></span></pre></td></tr><tr><td scope="row"><pre>        "model" : "IPAD",<span></span></pre></td></tr><tr><td scope="row"><pre>        "description" : "IPAD WI-FI 16GB",<span></span></pre></td></tr><tr><td scope="row"><pre>        "color": "BLACK",<span></span></pre></td></tr><tr><td scope="row"><pre>        "asset_tag" : "304214",<span></span></pre></td></tr><tr><td scope="row"><pre>        "device_assigned_by" : "facilitator1@sampleinc.com",<span></span></pre></td></tr><tr><td scope="row"><pre>        "device_assigned_date" : "2013-01-01T14:30:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>        "profile_uuid" : "88fc4e378fea4021a94b2d7268fbf767",<span></span></pre></td></tr><tr><td scope="row"><pre>        "profile_assign_time" : "2013-01-01T00:00:00Z",<span></span></pre></td></tr><tr><td scope="row"><pre>        "profile_push_time" : "2013-02-01T00:00:00Z"<span></span></pre></td></tr><tr><td scope="row"><pre>      },<span></span></pre></td></tr><tr><td scope="row"><pre>      "B7CJ500QF1MA" : {<span></span></pre></td></tr><tr><td scope="row"><pre>        "response_status" : "NOT_FOUND"<span></span></pre></td></tr><tr><td scope="row"><pre>      }<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW29" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>200</code> error with <code>NOT_FOUND</code> in the response body indicates that the specified device is not accessible by the MDM server.</p></li><li class="li"><p>A <code>400</code> error with <code>DEVICE_ID_REQUIRED</code> in the response body indicates that the request did not contain any devices.</p></li></ul></section></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW54" title="Disown Devices"></a><h4 class="jump">Disown Devices</h4><p>Tells Apple’s servers that your organization no longer owns one or more devices.</p><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-DontLinkElementID_6" title="Warning"></a><p><strong>Warning:</strong>&nbsp;Disowning a device is a permanent action.  After a short grace period, a disowned device cannot be reassigned to an MDM server in your organization.</p><p></p><div class="clear"></div></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW55" title="Note"></a><p><strong>Note:</strong>&nbsp;The server accepts only the <code>application/json</code> content type for this request.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW56" title=" URL"></a><h5 class="jump"> URL</h5><p><code>https://mdmenrollment.apple.com/devices/disown</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW57" title="Query Type"></a><h5 class="jump">Query Type</h5><p>POST</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW58" title="Request Body"></a><h5 class="jump">Request Body</h5><p>The request body should contain a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>Array of strings containing device serial numbers.</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>POST /devices/disown HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 30<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices":["C8TJ500QF1MN", "B7CJ500QF1MA"]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW59" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>A dictionary of devices. Each key in this dictionary is the serial number of a device in the original request. Each value is one of the following values:</p><ul class="threeHead"><li class="li"><p><code>SUCCESS</code>: Device was successfully disowned.</p></li><li class="li"><p><code>NOT_ACCESSIBLE</code>: A device with the specified ID was not accessible by this MDM server.</p></li><li class="li"><p><code>FAILED</code>: Disowning the device failed for an unexpected reason. If three retries fail, the user should contact Apple support.</p></li></ul><p>If no devices were provided in the original request, this dictionary may be absent.</p></td></tr></table></div><p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 03:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 160<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices": {<span></span></pre></td></tr><tr><td scope="row"><pre>        "C8TJ500QF1MN":"SUCCESS",<span></span></pre></td></tr><tr><td scope="row"><pre>        "B7CJ500QF1MA":"NOT_ACCESSIBLE"<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW60" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>400</code> error code with <code>DEVICE_ID_REQUIRED</code> in the response body indicates that no device IDs (serial numbers) were provided.</p></li></ul></section></section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW630" title="Activation Lock"></a><h4 class="jump">Activation Lock</h4>
<p>Find My iPhone Activation Lock is a feature of iCloud that makes it harder for anyone to use or resell a lost or stolen iOS device that has been enrolled under DEP.</p>

<p>The Activation Lock request is available in X-Server-Protocol-Version 2 and later to organizations that have enrolled through the Apple School Manager portal or Apple Business Manager portal.</p>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW631" title="Request"></a><h5 class="jump">Request</h5>
<p>To lock a device, POST an HTTP request in application/json format to the following URL: <code>https://mdmenrollment.apple.com/device/activationlock</code>. The request header must follow this format:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>POST /device/activationlock HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:&#60;client-software-information&#62;<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version: &#60;Integer, 2 or higher&#62;<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session:&#60;AUTH-TOKEN&#62;<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: &#60;Content_Length&#62;<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr></table></div>
<p>Immediately following the request header, send these content keys and values in application/json format:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Type</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Content</p></th></tr>
<tr><td  scope="row"><p><code>device</code></p></td><td ><p>String</p></td><td ><p>Serial number of the device (required).</p></td></tr>
<tr><td  scope="row"><p><code>escrow_key</code></p></td><td ><p>String</p></td><td ><p>Escrow key (optional). If the escrow key is not provided, the device will be locked against the person who created the MDM server in the portal. For information about creating an escrow key see <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW720" data-renderer-version="1">Escrow Keys and Bypass Codes</a></span>.</p></td></tr>
<tr><td  scope="row"><p><code>lost_message</code></p></td><td ><p>String</p></td><td ><p>Lost message to be displayed on the device (optional).</p></td></tr>
</table></div>
<p>A typical request might look like this:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>POST /device/activationlock HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 122<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>   "device": "C8TJ500QF1MN",<span></span></pre></td></tr><tr><td scope="row"><pre>   "escrow_key": "30a3449822ae82b94f1839ee0248a9e2350247d4<span></span></pre></td></tr><tr><td scope="row"><pre>                  b325071e6deb84285a6bfb34",<span></span></pre></td></tr><tr><td scope="row"><pre>   "lost_message": "Please phone 1-800-555-1212"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW632" title="Response"></a><h5 class="jump">Response</h5>
<p>The Apple server responds to the Activation Lock request with the following two keys:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Type</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Content</p></th></tr>
<tr><td  scope="row"><p><code>serial_number</code></p></td><td ><p>String</p></td><td ><p>Serial number of the device.</p></td></tr>
<tr><td  scope="row"><p><code>response_status</code></p></td><td ><p>String</p></td><td ><p><code>SUCCESS</code> or one of the failure responses listed below.</p></td></tr>
</table></div>
<p>Activation lock failure responses include the following:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Response</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Reason</p></th></tr>
<tr><td  scope="row"><p><code>NOT_ACCESSIBLE</code></p></td><td ><p>A device with this serial number is not accessible by this user.</p></td></tr>
<tr><td  scope="row"><p><code>ORG_NOT_SUPPORTED</code></p></td><td ><p>A device with this serial number is not supported because it is not present in the new program.</p></td></tr>
<tr><td  scope="row"><p><code>DEVICE_NOT_SUPPORTED</code></p></td><td ><p>Device type is not supported like Mac.</p></td></tr>
<tr><td  scope="row"><p><code>DEVICE_ALREADY_LOCKED</code></p></td><td ><p>Device is already locked by someone.</p></td></tr>
<tr><td  scope="row"><p><code>FAILED</code></p></td><td ><p>Activation lock of the device failed for unexpected reason. If retry fails, the client should contact Apple support.</p></td></tr>
</table></div>
<p>A successful activation lock response typically looks like this:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 03:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 160<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>     "serial_number" : "B7CJ500QF1MA",<span></span></pre></td></tr><tr><td scope="row"><pre>     "response_status" : "SUCCESS"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>Server failures during activation lock attempts typically look like one of the following two examples:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 500 Internal Server Error<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 0<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 31 May 2012 21:23:57 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>HTTP/1.1 503 Service Unavailable<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Retry-After: 120<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 0<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 31 May 2012 21:23:57 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr></table></div>
<p>A client failure during an activation lock attempt may look like this:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 4xx &#60;Error Reason&#62;<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain;Charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 10<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 31 May 2012 21:23:57 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&#60;ERROR_CODE&#62;<span></span></pre></td></tr></table></div>
<p>The combination of the ERROR_CODE in the response body shown above and the HTTP error typically indicates one of the following reasons for a client failure during an activation lock attempt:</p>
<ul class="ul">
<li class="li"><p>UNAUTHORIZED + HTTP 401: The auth token has expired. The client should retry with a new auth token.</p></li>
<li class="li"><p>FORBIDDEN + HTTP 403: The auth token is invalid.</p></li>
<li class="li"><p>MALFORMED_REQUEST_BODY + HTTP 400: The request body is malformed.</p></li>
</ul>
</section>
</section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW710" title="Activation Lock Bypass"></a><h4 class="jump">Activation Lock Bypass</h4>
<p>iOS 7.1 adds support for Activation Lock Bypass. This allows organizations to remove the Activation Lock from supervised devices prior to device activation without knowing the user’s personal Apple ID and password. </p>
<p>When an iOS device is configured as supervised it can generate a device-specific Activation Lock bypass code. A cryptographically-secure hash of the bypass code is stored by Apple’s activation server. This hash allows the activation server to verify that the correct bypass code has been provided to the device. For further information see <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW720" data-renderer-version="1">Escrow Keys and Bypass Codes</a></span>.</p>
<p>When the device creates a bypass code and hash, they’re stored in the device’s keychain and marked as available after first unlock and non-exportable.</p>
<p>To retrieve the bypass code, the MDM server uses the <code>ActivationLockBypassCode</code> query:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Type</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Content</p></th></tr>
<tr><td  scope="row"><p><code>RequestType</code></p></td><td ><p>String</p></td><td ><p><code>ActivationLockBypassCode</code>.</p></td></tr>
</table></div>
<div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW715" title="Note"></a><p><strong>Note:</strong>&nbsp;
The activation lock bypass code must be requested before the device receives the <span class="content_text"><a href="../3-MDM_Protocol/MDM_Protocol.html#//apple_ref/doc/uid/TP40017387-CH3-SW87" data-renderer-version="1">MDMOptions Sets Options Related to the MDM Protocol</a></span> setting that enables Activation Lock. If this sequence is not followed the user may lock the device before MDM installs the bypass, in which case the bypass code will not work.</p><p></p></aside></div>
<p>If a bypass code has never been created on the device, a new one is created when this query is received. If you have cleared the bypass code, or it has expired, the server will receive an error noting that the code has expired. The error code will be 12085.</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Type</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Content</p></th></tr>
<tr><td  scope="row"><p><code>ActivationLockBypassCode</code>.</p></td><td ><p>String</p></td><td ><p>The activation lock bypass code, if it’s available.</p></td></tr>
</table></div>
<p>Once retrieved and stored by the MDM server, the bypass code can be removed from the device using the <code>ClearActivationLockBypassCode</code> command:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Type</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Content</p></th></tr>
<tr><td  scope="row"><p><code>ClearActivationLockBypassCode</code></p></td><td ><p>String</p></td><td ><p>Supervised only. Clears the activation lock bypass code from the device.</p></td></tr>
</table></div>
<p>If the command is successful, an Acknowledged status is returned. If not removed, the bypass code is automatically deleted from the device after 15 days.</p>
<p>Once a device is erased, the bypass code can be manually entered when prompted by the Setup Assistant, leaving the username field empty. However, it’s recommended that an MDM server should clear the activation lock, using the web service described below, prior to erasing a device.</p>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW711" title="Authentication"></a><h5 class="jump">Authentication</h5>
<p>The MDM server must provide its APNS certificate when establishing the SSL connection with the web service.</p>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW712" title="Request"></a><h5 class="jump">Request</h5>
<p>To remove an activation lock, provide the device’s bypass code to the web service. The request should be a standard HTTPS POST on port 443 to <code>https://deviceservices-external.apple.com/ deviceservicesworkers/escrowKeyUnlock</code>. The request must also have the <code>contentType</code> header set to <code>application/x-www-form-urlencoded</code>.</p>
<p>The following arguments must be provided as part of the URL request string:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Argument</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Description</p></th></tr>

<tr><td  scope="row"><p>serial</p></td><td ><p>The device’s serial number (required).</p></td></tr>
<tr><td  scope="row"><p>imei</p></td><td ><p>Device IMEI (omitted for non-carrier devices).</p></td></tr>
<tr><td  scope="row"><p>meid</p></td><td ><p>Device MEID (omitted for non-carrier devices).</p></td></tr>
<tr><td  scope="row"><p>productType</p></td><td ><p>Example: iPod4,1 (required).</p></td></tr>
</table></div>
<p>The following arguments must go into the message body:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Argument</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Description</p></th></tr>

<tr><td  scope="row"><p>orgName</p></td><td ><p>Client-supplied value for auditing purposes: a string such as the name of the organization.</p></td></tr>
<tr><td  scope="row"><p>guid</p></td><td ><p>Client-supplied value for auditing purposes: a string that identifies the user requesting the removal (email, LDAP ID, name, etc.).</p></td></tr>
<tr><td  scope="row"><p>escrowKey</p></td><td ><p>The device’s bypass code. For further information see <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW720" data-renderer-version="1">Escrow Keys and Bypass Codes</a></span>.</p></td></tr>
</table></div>
<p>Arguments provided in the message body should be formatted as parameters in a form submission. For example:</p>
<p><code>escrowKey=abcdefg&amp;orgName=Acme+Inc&amp;guid=123456</code></p>
<p>The arguments string should comprise the entire message body.</p>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW713" title="HTTP Response Codes"></a><h5 class="jump">HTTP Response Codes</h5>
<p>The services can return any of the HTTP status codes, and the client is expected to handle the range of status codes. The more common ones include:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">
<tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Code</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Description</p></th></tr>

<tr><td  scope="row"><p>200</p></td><td ><p>Success.</p></td></tr>
<tr><td  scope="row"><p>400</p></td><td ><p>Failure: bad request; likely cause is a malformed request query or body.</p></td></tr>
<tr><td  scope="row"><p>404</p></td><td ><p>Failure: device is not found, or escrowKey is invalid.</p></td></tr>
<tr><td  scope="row"><p>500</p></td><td ><p>Unexpected server error; try again later.</p></td></tr>
</table></div>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW714" title="Response Body Format"></a><h5 class="jump">Response Body Format</h5>
<p>The response body may contain diagnostic information useful when reporting issues to Apple. Do not rely on specific codes, because they may change.</p>
</section>
</section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW720" title="Escrow Keys and Bypass Codes"></a><h4 class="jump">Escrow Keys and Bypass Codes</h4>
<p>Your MDM server implementation should store two bypass codes:</p>
<ul class="ul">
<li class="li"><p>The device-generated bypass code retrieved using the <code>ActivationLockBypassCode</code> device query. The server should retain this code until it receives a different, non-empty code from the device.</p></li>
<li class="li"><p>The bypass code the server creates when initiating an activation lock through MDM.</p></li>
</ul>
<p>The server should try to unlock the device with the bypass code most likely to be active, then try the other code if the first one fails. It is impossible for the server to be certain which code is active at a given time (or even to determine if the device is locked at all) because the device can always be erased and its activation lock removed manually by entering the correct Apple ID or password. The device’s <code>IsActivationLockEnabled</code> value is not an accurate reflection of its true activation lock state because the device can report either a false positive or a false negative.</p>

<p>Following is a sample of code that generates both an escrow key and a bypass code:</p>
<div class="codesample clear"><table><tr><td scope="row"><pre>#define MCBYPASS_CODE_LENGTH 31 // Excluding terminating null<span></span></pre></td></tr><tr><td scope="row"><pre>#define MCBYPASS_CODE_BUFFER_LENGTH 32 // Including terminating null<span></span></pre></td></tr><tr><td scope="row"><pre>#define MCBYPASS_RAW_BYTES_LENGTH 16<span></span></pre></td></tr><tr><td scope="row"><pre>#define MCBYPASS_HASH_LENGTH CC_SHA256_DIGEST_LENGTH<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (NSString*) _createNewActivationLockBypassCodeOutHash:(NSString**)outHash<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>#define RANDOM_BYTES_LENGTH 16<span></span></pre></td></tr><tr><td scope="row"><pre>#define SALT_LENGTH 4<span></span></pre></td></tr><tr><td scope="row"><pre>    // Encode raw bytes<span></span></pre></td></tr><tr><td scope="row"><pre>    static const char kSymbols[] = "0123456789ACDEFGHJKLMNPQRTUVWXYZ";<span></span></pre></td></tr><tr><td scope="row"><pre>                                //  00000000000000001111111111111111<span></span></pre></td></tr><tr><td scope="row"><pre>                                //  0123456789abcdef0123456789abcdef<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Insert dashes after outputting characters at these positions<span></span></pre></td></tr><tr><td scope="row"><pre>    static const int kDashPositions[] = { 5, 10, 14, 18, 22 };<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    char    rawBytes[MCBYPASS_RAW_BYTES_LENGTH];<span></span></pre></td></tr><tr><td scope="row"><pre>    char    code[MCBYPASS_CODE_BUFFER_LENGTH];<span></span></pre></td></tr><tr><td scope="row"><pre>    uint8_t hash[MCBYPASS_HASH_LENGTH];<span></span></pre></td></tr><tr><td scope="row"><pre>    uint8_t salt[SALT_LENGTH] = {0, 0, 0, 0};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    arc4random_buf(rawBytes, RANDOM_BYTES_LENGTH);<span></span></pre></td></tr><tr><td scope="row"><pre>    CCKeyDerivationPBKDF(kCCPBKDF2, rawBytes, RANDOM_BYTES_LENGTH, salt, SALT_LENGTH,<span></span></pre></td></tr><tr><td scope="row"><pre>        kCCPRFHmacAlgSHA256, 50000, hash, CC_SHA256_DIGEST_LENGTH);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (outHash) {<span></span></pre></td></tr><tr><td scope="row"><pre>        int                 len = MCBYPASS_HASH_LENGTH;<span></span></pre></td></tr><tr><td scope="row"><pre>        NSMutableString*    str = [NSMutableString stringWithCapacity:MCBYPASS_HASH_LENGTH * 2 + 1];<span></span></pre></td></tr><tr><td scope="row"><pre>        const uint8_t*      p   = (const uint8_t*)hash;<span></span></pre></td></tr><tr><td scope="row"><pre>        while (len-- &gt; 0) [str appendFormat:@"%02X", *p++];<span></span></pre></td></tr><tr><td scope="row"><pre>        *outHash = [NSString stringWithString:str];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    int         outputCharacterCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    const int*  nextDashPosition     = kDashPositions;<span></span></pre></td></tr><tr><td scope="row"><pre>    char*       outputCursor         = code;<span></span></pre></td></tr><tr><td scope="row"><pre>    uint8_t*    inputCursor          = (uint8_t*)rawBytes;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Generate output one symbol at a time<span></span></pre></td></tr><tr><td scope="row"><pre>#define INPUT_BITS      128<span></span></pre></td></tr><tr><td scope="row"><pre>#define BITS_PER_BYTE   8<span></span></pre></td></tr><tr><td scope="row"><pre>#define BITS_PER_SYMBOL 5<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    int bitsProcessed     = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    int bitOffsetIntoByte = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    while (bitsProcessed &#60;= (INPUT_BITS - BITS_PER_SYMBOL)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        int bitsThisByte = (bitOffsetIntoByte &#60; BITS_PER_BYTE - BITS_PER_SYMBOL<span></span></pre></td></tr><tr><td scope="row"><pre>            ? BITS_PER_SYMBOL : BITS_PER_BYTE - bitOffsetIntoByte);<span></span></pre></td></tr><tr><td scope="row"><pre>        int bitsNextByte = (bitsThisByte &#60; BITS_PER_SYMBOL ? BITS_PER_SYMBOL<span></span></pre></td></tr><tr><td scope="row"><pre>            - bitsThisByte : 0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        uint8_t value = (((*inputCursor &#60;&#60; bitOffsetIntoByte) &amp; 0xff)<span></span></pre></td></tr><tr><td scope="row"><pre>        &#62;&#62; (BITS_PER_BYTE - bitsThisByte));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        bitOffsetIntoByte += BITS_PER_SYMBOL;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (bitOffsetIntoByte &#62;= BITS_PER_BYTE) {<span></span></pre></td></tr><tr><td scope="row"><pre>            bitOffsetIntoByte -= BITS_PER_BYTE;<span></span></pre></td></tr><tr><td scope="row"><pre>            inputCursor++;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (bitsNextByte) {<span></span></pre></td></tr><tr><td scope="row"><pre>            value &#60;&#60;= bitsNextByte;<span></span></pre></td></tr><tr><td scope="row"><pre>            value |= (*inputCursor &#62;&#62; (BITS_PER_BYTE - bitsNextByte));<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>       *outputCursor++ = kSymbols[value];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (++outputCharacterCount == *nextDashPosition) {<span></span></pre></td></tr><tr><td scope="row"><pre>            ++nextDashPosition;<span></span></pre></td></tr><tr><td scope="row"><pre>            *outputCursor++ = '-';<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        bitsProcessed += BITS_PER_SYMBOL;<span></span></pre></td></tr><tr><td scope="row"><pre>    } // while<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Process remaining bits<span></span></pre></td></tr><tr><td scope="row"><pre>    int bitsRemaining = INPUT_BITS - bitsProcessed;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (bitsRemaining) {<span></span></pre></td></tr><tr><td scope="row"><pre>        uint8_t value = (((*inputCursor &#60;&#60; bitOffsetIntoByte) &amp; 0xff)<span></span></pre></td></tr><tr><td scope="row"><pre>            &#62;&#62; (BITS_PER_BYTE - bitsRemaining));<span></span></pre></td></tr><tr><td scope="row"><pre>       *outputCursor++ = kSymbols[value];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    *outputCursor = '\0';<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSString stringWithUTF8String:code];<span></span></pre></td></tr><tr><td scope="row"><pre>} // -_createNewActivationLockBypassCodeOutHash:<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div>
</section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW30" title="Define Profile"></a><h4 class="jump">Define Profile</h4><p>Tells Apple’s servers about a profile that can then be assigned to specific devices. This command provides information about the MDM server that is assigned to manage one or more devices, information about the host that the managed devices can pair with, and various attributes that control the MDM association behavior of the device.</p>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW31" title=" URL"></a><h5 class="jump"> URL</h5><p><code>https://mdmenrollment.apple.com/profile</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW32" title="Query Type"></a><h5 class="jump">Query Type</h5><p>POST</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW33" title="Request Body"></a><h5 class="jump">Request Body</h5><p>The request body should contain a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr>

<tr><td  scope="row"><p><code>profile_name</code></p></td><td ><p>String. A human-readable name for the profile.</p></td></tr>



<tr><td  scope="row"><p><code>url</code></p></td><td ><p>String. The URL of the MDM server.</p></td></tr><tr><td  scope="row"><p><code>allow_pairing</code></p></td><td ><p>Optional. Boolean. Default is <code>true</code>.</p></td></tr><tr><td  scope="row"><p><code>is_supervised</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, the device must be supervised. Defaults to <code>false</code>.</p><p>In iOS 11, DEP devices that are not supervised have been deprecated. In a future release, all DEP devices will be supervised and the OS will ignore the <code>is_supervised</code> flag completely.</p></td></tr>

<tr><td  scope="row"><p><code>is_multi_user</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, tells the device to configure for Shared iPad. Default is <code>false</code>. This key is valid only for Apple School Manager organizations using X-Server-Protocol-Version 2 and later.</p><p>Devices that do not meet the Shared iPad minimum requirements do not honor this command. With iOS devices, <code>com.apple.mdm.per-user-connections</code> must be added to the MDM enrollment profile’s <code>ServerCapabilities</code>. See <span class="content_text"><a href="../3-MDM_Protocol/MDM_Protocol.html#//apple_ref/doc/uid/TP40017387-CH3-SW659" data-renderer-version="1">iOS Support for Per-User Connections</a></span>.</p></td></tr>

<tr><td  scope="row"><p><code>is_mandatory</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, the user may not skip applying the profile returned by the MDM server. Default is <code>false</code>.</p></td></tr>

<tr><td  scope="row"><p><code>await_device_configured</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, the device will not continue in Setup Assistant until the MDM server sends a command stating that the device is configured (see <span class="content_text"><a href="../3-MDM_Protocol/MDM_Protocol.html#//apple_ref/doc/uid/TP40017387-CH3-SW301" data-renderer-version="1">DeviceConfigured</a></span>). Default is <code>false</code>. Ignored on iOS devices if <code>is_supervised</code> is <code>false</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>is_mdm_removable</code></p></td><td ><p>If <code>false</code>, the MDM payload delivered by the configuration URL cannot be removed by the user via the user interface on the device; that is, the MDM payload is locked onto the device. This key can be set to <code>false</code> only if <code>is_supervised</code> is set to <code>true</code>. Defaults to <code>true</code>.</p></td></tr>

<tr><td  scope="row"><p><code>support_phone_number</code></p></td><td ><p>Optional. String. A support phone number for the organization.</p></td></tr>

<tr><td  scope="row"><p><code>auto_advance_setup</code></p></td><td ><p>Optional. Boolean. If set to <code>true</code>, the device will tell tvOS Setup Assistant to automatically advance though its screens. Default is false. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>support_email_address</code></p></td><td ><p>Optional. String. A support email address for the organization. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>org_magic</code></p></td><td ><p>A string that uniquely identifies various services that are managed by a single organization.</p></td></tr><tr><td  scope="row"><p><code>anchor_certs</code></p></td><td ><p>Optional. Array of strings. Each string should contain a DER-encoded certificate converted to Base64 encoding. If provided, these certificates are used as trusted anchor certificates when evaluating the trust of the connection to the MDM server URL. Otherwise, the built-in root certificates are used.</p></td></tr><tr><td  scope="row"><p><code>supervising_host_certs</code></p></td><td ><p>Optional. Array of strings. Each string contains a DER-encoded certificate converted to Base64 encoding. If provided, the device will continue to pair with a host possessing one of these certificates even when <code>allow_pairing</code> is set to <code>false</code>. If <code>is_supervised</code> is <code>false</code>, this list is unused. </p></td></tr><tr><td  scope="row"><p><code>skip_setup_items</code></p></td><td ><p>Optional. Array of strings. A list of setup panes to skip. The array may contain one or more of the following strings:</p><ul class="threeHead"><li class="li"><p><code>AppleID</code>: Skips Apple ID setup.</p></li>

<li class="li"><p><code>Biometric</code>: Skips Touch ID setup.</p></li><li class="li"><p><code>Diagnostics</code>: Disables automatically sending diagnostic information.</p></li>

<li class="li"><p><code>DisplayTone</code>: Skips DisplayTone setup.</p></li>
<li class="li"><p><code>Location</code>: Disables Location Services.</p></li>
<li class="li"><p><code>Passcode</code>: Hides and disables the passcode pane.</p></li>

<li class="li"><p><code>Payment</code>: Skips Apple Pay setup.</p></li><li class="li"><p><code>Privacy</code>: Skips privacy pane.</p></li>
<li class="li"><p><code>Restore</code>: Disables restoring from backup.</p></li>

<li class="li"><p><code>Siri</code>: Disables Siri.</p></li>

<li class="li"><p><code>TOS</code>: Skips Terms and Conditions.</p></li>

<li class="li"><p><code>Zoom</code>: Skips zoom setup.</p></li>

<li class="li"><p><code>Android</code>: If the Restore pane is not skipped, removes Move from Android option from it.</p></li><li class="li"><p><code>HomeButtonSensitivity</code>: Skips the Home Button screen in iOS.</p></li>

<li class="li"><p><code>iMessageAndFaceTime</code>: Skips the iMessage and FaceTime screen in iOS.</p></li>

<li class="li"><p><code>OnBoarding</code>: Skips on-boarding informational screens for user education (“Cover Sheet, Multitasking &amp; Control Center”, for example) in iOS.</p></li><li class="li"><p><code>WatchMigration</code>: Skips the screen for watch migration in iOS.</p></li>

<li class="li"><p><code>FileVault</code>: Disables FileVault Setup Assistant screen in macOS.</p></li><li class="li"><p><code>iCloudDiagnostics</code>: Skips iCloud Analytics screen in macOS.</p></li><li class="li"><p><code>iCloudStorage</code>: Skips iCloud Documents and Desktop screen in macOS.</p></li><li class="li"><p><code>Registration</code>: Disables registration screen in macOS.</p></li><li class="li"><p><code>ScreenSaver</code>: Skips the tvOS screen about using aerial screensavers in ATV.</p></li><li class="li"><p><code>TapToSetup</code>: Skips the Tap To Set Up option in ATV about using an iOS device to set up your ATV (instead of entering all your account information and setting choices separately).</p></li><li class="li"><p><code>TVHomeScreenSync</code>: Skips TV home screen layout sync screen in tvOS.</p></li><li class="li"><p><code>TVProviderSignIn</code>: Skips the TV provider sign in screen in tvOS.</p></li><li class="li"><p><code>TVRoom</code>: Skips the “Where is this Apple TV?” screen in tvOS.</p></li>

</ul></td></tr><tr><td  scope="row"><p><code>department</code></p></td><td ><p>Optional. String. The user-defined department or location name.</p></td></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>Array of strings containing device serial numbers. (May be empty.)</p></td></tr><tr><td  scope="row"><p><code>language</code></p></td><td ><p>Optional. String. A language designator is a code that represents a language. Available on tvOS.</p><p> Use the two-letter ISO 639-1 standard (preferred) or the three-letter ISO 639-2 standard. If an ISO 639-1 code is not available for a particular language, use the ISO 639-2 code instead.</p><p><span class="content_text"><a href="https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPInternational/LanguageandLocaleIDs/LanguageandLocaleIDs.html" class="urlLink" rel="external">Apple Developer Localization Documentation</a></span></p><p>Example two-letter: en, fr, ja</p><p>Example three-letter: eng, fre, jpn, haw</p></td></tr><tr><td  scope="row"><p><code>region</code></p></td><td ><p>Optional. String. A region designator is a code that represents a country. Available on tvOS.</p><p>Use the ISO 3166-1 standard, a two-letter, capitalized code.</p><p>Examples: US, GB, AU</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>POST /profile HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 350<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>   "profile_name": "Test Profile",<span></span></pre></td></tr><tr><td scope="row"><pre>   "url":"https://mdm.acmeinc.com/getconfig",<span></span></pre></td></tr><tr><td scope="row"><pre>   "is_supervised":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "allow_pairing":true,<span></span></pre></td></tr><tr><td scope="row"><pre>   "is_mandatory":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "await_device_configured":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "is_multi_user":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "is_mdm_removable":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "department": "IT Department",<span></span></pre></td></tr><tr><td scope="row"><pre>   "org_magic": "913FABBB-0032-4E13-9966-D6BBAC900331",<span></span></pre></td></tr><tr><td scope="row"><pre>   "support_phone_number": "1-555-555-5555",<span></span></pre></td></tr><tr><td scope="row"><pre>   "anchor_certs":[<span></span></pre></td></tr><tr><td scope="row"><pre>      "MIICkDCCAfmgAwIBAgIJAOAeuvyohALaMA0GCSqGSIb3DQEBBQUAMGExCzAJBgNVBAYT..."<span></span></pre></td></tr><tr><td scope="row"><pre>   ],<span></span></pre></td></tr><tr><td scope="row"><pre>   "supervising_host_certs:[<span></span></pre></td></tr><tr><td scope="row"><pre>        "AlVTMQswCQYDVQQIDAJDQTESMBAGA1UEBwwJQ3VwZXJ0aW5vMRowGAYDVQQKDBFB…"<span></span></pre></td></tr><tr><td scope="row"><pre>    ],<span></span></pre></td></tr><tr><td scope="row"><pre>   "skip_setup_items":[<span></span></pre></td></tr><tr><td scope="row"><pre>      "Location",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Restore",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Android",<span></span></pre></td></tr><tr><td scope="row"><pre>      "AppleID",<span></span></pre></td></tr><tr><td scope="row"><pre>      "TOS",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Siri",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Diagnostics",<span></span></pre></td></tr><tr><td scope="row"><pre>      "HomeButtonSensitivity",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Biometric",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Payment",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Zoom",<span></span></pre></td></tr><tr><td scope="row"><pre>      "DisplayTone",<span></span></pre></td></tr><tr><td scope="row"><pre>      "FileVault",<span></span></pre></td></tr><tr><td scope="row"><pre>      "TapToSetup",<span></span></pre></td></tr><tr><td scope="row"><pre>      "ScreenSaver"<span></span></pre></td></tr><tr><td scope="row"><pre>   ],<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices":["C8TJ500QF1MN", "B7CJ500QF1MA"]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW34" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>The profile’s UUID (hex string).</p></td></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>A dictionary of devices. Each key in this dictionary is the serial number of a device in the original request. Each value is one of the following strings:</p><ul class="threeHead"><li class="li"><p><code>SUCCESS</code>: The profile was mapped to the device.</p></li><li class="li"><p><code>NOT_ACCESSIBLE</code>: A device with the specified serial number was not accessible by this server.</p></li><li class="li"><p><code>FAILED</code>: Assigning the profile failed for an unexpected reason. If three retries fail, the user should contact Apple support.</p></li></ul></td></tr></table></div><p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 03:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 160<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "profile_uuid": "88fc4e378fea4021a94b2d7268fbf767",<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices": {<span></span></pre></td></tr><tr><td scope="row"><pre>          "C8TJ500QF1MN":"SUCCESS",<span></span></pre></td></tr><tr><td scope="row"><pre>          "B7CJ500QF1MA":"NOT_ACCESSIBLE"<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW35" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>400</code> error code with <code>CONFIG_URL_REQUIRED</code> in the response body indicates that the MDM server URL is missing in the profile.</p></li>
<li class="li"><p>A <code>400</code> error code with <code>CONFIG_NAME_REQUIRED</code> in the response body indicates that the configuration name is missing in the profile.</p></li>
<li class="li"><p>A <code>400</code> error code with <code>FLAGS_INVALID</code> in the response body indicates that flags have been set incorrectly. Flag <code>is_mdm_removable</code> can be set to <code>false</code> only if flag <code>is_supervised</code> is set to <code>true</code>.</p></li>
<li class="li"><p>A <code>400</code> error code with <code>CONFIG_URL_INVALID</code> in the response body indicates that the URL field in the uploaded profile is either empty or has exceeded the maximum allowed length (2000 URL encoded characters). The syntax of the URL is defined by <span class="content_text"><a href="http://www.ietf.org/rfc/rfc2396.txt" class="urlLink" rel="external">RFC 2396: Uniform Resource Identifiers (URI): Generic Syntax</a></span>, amended by <span class="content_text"><a href="http://www.ietf.org/rfc/rfc2732.txt" class="urlLink" rel="external">RFC 2732: Format for Literal IPv6 Addresses in URLs</a></span>.</p></li><li class="li"><p>A <code>400</code> error code with <code>CONFIG_NAME_INVALID</code> in the response body indicates that the <code>profile_name</code> field in the uploaded profile is either empty or has exceeded the maximum allowed length (125 UTF-8 characters).</p></li><li class="li"><p>A <code>400</code> error code with <code>DEPARTMENT_INVALID</code> in the response body indicates that the <code>department</code> field in the uploaded profile is either empty or has exceeded the maximum allowed length (125 UTF-8 characters).</p></li>

<li class="li"><p>A <code>400</code> error code with <code>SUPPORT_PHONE_INVALID</code> in the response body indicates that the <code>support_phone_number</code> field in the uploaded profile is either empty or has exceeded the maximum allowed length (50 UTF-8 characters).</p></li>

<li class="li"><p>A <code>400</code> error code with <code>SUPPORT_EMAIL_INVALID</code> in the response body indicates that the <code>support_email_address</code> field in the uploaded profile is either empty or has exceeded the maximum allowed length (250 UTF-8 characters).</p></li>



<li class="li"><p>A <code>400</code> error code with <code>MAGIC_INVALID</code> in the response body indicates that the <code>magic</code> field in the uploaded profile is either empty or has exceeded the maximum allowed length (256 UTF-8 characters).</p></li><li class="li"><p>A <code>400</code> error code with <code>LOCALE_INVALID</code> in the response body indicates that the local fields combination is invalid or unsupported.</p></li>
</ul></section></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW36" title="Assign Profile "></a><h4 class="jump">Assign Profile </h4><p>Tells Apple’s severs that the specified devices should use a particular profile defined by the <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW30" data-renderer-version="1">Define Profile</a></span> command.</p>


<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW37" title="URL"></a><h5 class="jump">URL</h5><p><code>https://mdmenrollment.apple.com/profile/devices</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW38" title="Query Type"></a><h5 class="jump">Query Type</h5><p>PUT</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW39" title="Request Body"></a><h5 class="jump">Request Body</h5><p>The request body should contain a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>The UUID (string) for the profile that you want to assign to the specified devices. This UUID was returned by a previous Define Profile request.</p></td></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>Array of strings containing device serial numbers. An empty array is considered a no-op.</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>PUT /profile/devices HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 38<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>   "profile_uuid": "88fc4e378fea4021a94b2d7268fbf767",<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices":["C8TJ500QF1MN", "B7CJ500QF1MA"]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW40" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>The profile’s UUID (string).</p></td></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>A dictionary of devices. Each key in this dictionary is the serial number of a device in the original request. Each value is a string with one of the following values:</p><ul class="threeHead"><li class="li"><p><code>SUCCESS</code>: Profile was mapped to the device.</p></li><li class="li"><p><code>NOT_ACCESSIBLE</code>: A device with the specified ID was not accessible by this MDM server.</p></li><li class="li"><p><code>FAILED</code>: Assigning the profile failed for an unexpected reason. If three retries fail, the user should contact Apple support.</p></li></ul></td></tr></table></div><p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 03:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 160<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "profile_uuid": "88fc4e378fea4021a94b2d7268fbf767",<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices": {<span></span></pre></td></tr><tr><td scope="row"><pre>                  "C8TJ500QF1MN":"SUCCESS",<span></span></pre></td></tr><tr><td scope="row"><pre>                  "B7CJ500QF1MA":"NOT_ACCESSIBLE"<span></span></pre></td></tr><tr><td scope="row"><pre>               }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW41" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>400</code> error with <code>DEVICE_ID_REQUIRED</code> in the body of the response indicates that the request did not contain any device IDs.</p></li><li class="li"><p>A <code>400</code> error with <code>PROFILE_UUID_REQUIRED</code> in the body of the response indicates that the request did not contain a profile ID.</p></li><li class="li"><p>A <code>404</code> error with <code>NOT_FOUND</code> in the body of the response indicates that the profile with the specified UUID could not be found.</p></li></ul></section></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW61" title="Fetch Profile"></a><h4 class="jump">Fetch Profile</h4><p>Returns information about a profile.</p><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW62" title="URL"></a><h5 class="jump">URL</h5><p><code>https://mdmenrollment.apple.com/profile</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW63" title="Query Type"></a><h5 class="jump">Query Type</h5><p>GET</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW64" title="Request Query"></a><h5 class="jump">Request Query</h5><p>The query string should contain the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>The UUID of a profile.</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>GET /profile?profile_uuid=3dd2ccafe97bf07130fe3c908a92c870 HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 0<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW65" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>profile_name</code></p></td><td ><p>String. A human-readable name for the profile.</p></td></tr>

<tr><td  scope="row"><p><code>profile_uuid</code></p></td><td ><p>String. The unique ID of the assigned profile.</p></td></tr>

<tr><td  scope="row"><p><code>url</code></p></td><td ><p>String. The URL of the MDM server.</p></td></tr><tr><td  scope="row"><p><code>allow_pairing</code></p></td><td ><p>Optional. Boolean. Default is <code>true</code>.</p></td></tr><tr><td  scope="row"><p><code>is_supervised</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, the device must be supervised. Defaults to <code>false</code>. </p><p>In iOS 11, DEP devices that are not supervised have been deprecated. In a future release, all DEP devices will be supervised and the OS will ignore the <code>is_supervised</code> flag completely.</p></td></tr>

<tr><td  scope="row"><p><code>is_multi_user</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, tells the device to configure for Shared iPad. Default is <code>false</code>. This key is valid only for Apple School Manager organizations using X-Server-Protocol-Version 2 and later.</p><p>Devices that do not meet the Shared iPad minimum requirements do not honor this command. With iOS devices, <code>com.apple.mdm.per-user-connections</code> must be added to the MDM enrollment profile’s <code>ServerCapabilities</code>. See <span class="content_text"><a href="../3-MDM_Protocol/MDM_Protocol.html#//apple_ref/doc/uid/TP40017387-CH3-SW659" data-renderer-version="1">iOS Support for Per-User Connections</a></span>.</p></td></tr>

<tr><td  scope="row"><p><code>is_mandatory</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, the user may not skip applying the profile returned by the MDM server. Default is <code>false</code>.</p></td></tr>

<tr><td  scope="row"><p><code>await_device_configured</code></p></td><td ><p>Optional. Boolean. If <code>true</code>, the device will not continue in Setup Assistant until the MDM server sends a command stating that the device is configured (see <span class="content_text"><a href="../3-MDM_Protocol/MDM_Protocol.html#//apple_ref/doc/uid/TP40017387-CH3-SW301" data-renderer-version="1">DeviceConfigured</a></span>). Default is <code>false</code>. Ignored on iOS devices if <code>is_supervised</code> is <code>false</code>. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>is_mdm_removable</code></p></td><td ><p>If <code>false</code>, the MDM payload delivered by the configuration URL cannot be removed by the user using the user interface on the device; that is, the MDM payload is locked onto the device. Defaults to <code>true</code>.</p></td></tr><tr><td  scope="row"><p><code>support_phone_number</code></p></td><td ><p>Optional. String. A support phone number for the organization.</p></td></tr>

<tr><td  scope="row"><p><code>support_email_address</code></p></td><td ><p>Optional. String. A support email address for the organization. This key is valid in X-Server-Protocol-Version 2 and later.</p></td></tr>

<tr><td  scope="row"><p><code>org_magic</code></p></td><td ><p>A string that uniquely identifies various services that are managed by a single organization.</p></td></tr><tr><td  scope="row"><p><code>anchor_certs</code></p></td><td ><p>Optional. Array of strings. Each string should contain a DER-encoded certificate converted to Base64 encoding. If provided, these certificates are used as trusted anchor certificates when evaluating the trust of the connection to the MDM server URL. Otherwise, the built-in root certificates are used.</p></td></tr><tr><td  scope="row"><p><code>supervising_host_certs</code></p></td><td ><p>Optional. Array of strings. Each string contains a DER-encoded certificate converted to Base64 encoding. If provided, the device will continue to pair with a host possessing one of these certificates even when <code>allow_pairing</code> is set to <code>false</code>. If <code>is_supervised</code> is <code>false</code>, this list is unused. </p></td></tr><tr><td  scope="row"><p><code>skip_setup_items</code></p></td><td ><p>Optional. Array of strings. A list of setup panes to skip. The array may contain one or more of the following strings:</p><ul class="threeHead"><li class="li"><p><code>AppleID</code>: Skips Apple ID setup.</p></li><li class="li"><p><code>Biometric</code>: Skips Touch ID setup.</p></li><li class="li"><p><code>Diagnostics</code>: Disables automatically sending diagnostic information.</p></li><li class="li"><p><code>DisplayTone</code>: Skips DisplayTone setup.</p></li><li class="li"><p><code>Location</code>: Disables Location Services.</p></li><li class="li"><p><code>Passcode</code>: Hides and disables the passcode pane.</p></li><li class="li"><p><code>Payment</code>: Skips Apple Pay setup.</p></li><li class="li"><p><code>Privacy</code>: Skips privacy pane.</p></li><li class="li"><p><code>Restore</code>: Disables restoring from backup.</p></li><li class="li"><p><code>Siri</code>: Disables Siri.</p></li><li class="li"><p><code>TOS</code>: Skips Terms and Conditions.</p></li><li class="li"><p><code>Zoom</code>: Skips zoom setup.</p></li><li class="li"><p><code>Android</code>: If the Restore pane is not skipped, removes Move from Android option from it.</p></li><li class="li"><p><code>HomeButtonSensitivity</code>: Skips the Home Button screen in iOS.</p></li><li class="li"><p><code>iMessageAndFaceTime</code>: Skips the iMessage and FaceTime screen in iOS.</p></li><li class="li"><p><code>OnBoarding</code>: Skips on-boarding informational screens for user education (“Cover Sheet, Multitasking &amp; Control Center”, for example) in iOS.</p></li><li class="li"><p><code>WatchMigration</code>: Skips the screen for watch migration in iOS.</p></li><li class="li"><p><code>FileVault</code>: Disables FileVault Setup Assistant screen in macOS.</p></li><li class="li"><p><code>iCloudDiagnostics</code>: Skips iCloud Analytics screen in macOS.</p></li><li class="li"><p><code>iCloudStorage</code>: Skips iCloud Documents and Desktop screen in macOS.</p></li><li class="li"><p><code>Registration</code>: Disables registration screen in macOS.</p></li><li class="li"><p><code>ScreenSaver</code>: Skips the tvOS screen about using aerial screensavers in ATV.</p></li><li class="li"><p><code>TapToSetup</code>: Skips the Tap To Set Up option in ATV about using an iOS device to set up your ATV (instead of entering all your account information and setting choices separately).</p></li><li class="li"><p><code>TVHomeScreenSync</code>: Skips TV home screen layout sync screen in tvOS.</p></li><li class="li"><p><code>TVProviderSignIn</code>: Skips the TV provider sign in screen in tvOS.</p></li><li class="li"><p><code>TVRoom</code>: Skips the “Where is this Apple TV?” screen in tvOS.</p></li></ul></td></tr>

<tr><td  scope="row"><p><code>department</code></p></td><td ><p>Optional. The user-defined department or location name.</p></td></tr><tr><td  scope="row"><p><code>language</code></p></td><td ><p>Optional. String. A language designator is a code that represents a language. Use the two-letter ISO 639-1 standard (preferred) or the three-letter ISO 639-2 standard. If an ISO 639-1 code is not available for a particular language, use the ISO 639-2 code instead.</p><p><span class="content_text"><a href="https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPInternational/LanguageandLocaleIDs/LanguageandLocaleIDs.html" class="urlLink" rel="external">Apple Developer Localization Documentation</a></span></p><p>Example two-letter: en, fr, ja</p><p>Example three-letter: eng, fre, jpn, haw</p></td></tr><tr><td  scope="row"><p><code>region</code></p></td><td ><p>Optional. String. A region designator is a code that represents a country. Use the ISO 3166-1 standard, a two-letter, capitalized code.</p><p>Examples: US, GB, AU</p></td></tr></table></div><p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 28 Feb 2013 02:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 160<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>   "profile_uuid": "88fc4e378fea4021a94b2d7268fbf767",<span></span></pre></td></tr><tr><td scope="row"><pre>   "profile_name": "Test Profile",<span></span></pre></td></tr><tr><td scope="row"><pre>   "url":"https://mdm.acmeinc.com/getconfig",<span></span></pre></td></tr><tr><td scope="row"><pre>   "is_supervised":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "allow_pairing":true,<span></span></pre></td></tr><tr><td scope="row"><pre>   "is_mandatory":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "await_device_configured":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "is_mdm_removable":false,<span></span></pre></td></tr><tr><td scope="row"><pre>   "department": "IT Department",<span></span></pre></td></tr><tr><td scope="row"><pre>   "org_magic": "913FABBB-0032-4E13-9966-D6BBAC900331",<span></span></pre></td></tr><tr><td scope="row"><pre>   "support_phone_number": "1-555-555-5555",<span></span></pre></td></tr><tr><td scope="row"><pre>   "support_email_address": "org-email@example.com",<span></span></pre></td></tr><tr><td scope="row"><pre>   "anchor_certs":[<span></span></pre></td></tr><tr><td scope="row"><pre>      "MIICkDCCAfmgAwIBAgIJAOAeuvyohALaMA0GCSqGSIb3DQEBBQUAMGExCzAJBgNVBAYT..."<span></span></pre></td></tr><tr><td scope="row"><pre>   ],<span></span></pre></td></tr><tr><td scope="row"><pre>   "supervising_host_certs:[<span></span></pre></td></tr><tr><td scope="row"><pre>        "AlVTMQswCQYDVQQIDAJDQTESMBAGA1UEBwwJQ3VwZXJ0aW5vMRowGAYDVQQKDBFB…"<span></span></pre></td></tr><tr><td scope="row"><pre>    ],<span></span></pre></td></tr><tr><td scope="row"><pre>   "skip_setup_items":[<span></span></pre></td></tr><tr><td scope="row"><pre>      "Location",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Restore",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Android",<span></span></pre></td></tr><tr><td scope="row"><pre>      "AppleID",<span></span></pre></td></tr><tr><td scope="row"><pre>      "TOS",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Siri",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Diagnostics",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Biometric",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Payment",<span></span></pre></td></tr><tr><td scope="row"><pre>      "Zoom",<span></span></pre></td></tr><tr><td scope="row"><pre>      "FileVault",<span></span></pre></td></tr><tr><td scope="row"><pre>      "TapToSetup",<span></span></pre></td></tr><tr><td scope="row"><pre>      "ScreenSaver"<span></span></pre></td></tr><tr><td scope="row"><pre>   ]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW66" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>400</code> error with <code>PROFILE_UUID_REQUIRED</code> in the body of the response indicates that the request did not contain a profile UUID.</p></li><li class="li"><p>A <code>404</code> error with <code>NOT_FOUND</code> in the body of the response indicates that a profile cannot be found for the requested profile UUID.</p></li><li class="li"><p>A <code>400</code> error code with <code>LOCALE_INVALID</code> in the response body indicates that the local fields combination is invalid or unsupported.</p></li></ul></section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW242" title="Request to a Profile URL"></a><h5 class="jump">Request to a Profile URL</h5>

<p>When a <code>url</code> value is provided in the profile response, the device makes an HTTPS POST call to that URL. The requesthas a Content-Type of <code>application/pkcs7-signature</code>. The following dictionary is sent as the body of the request. The dictionary is encoded as an XML plist and then CMS-signed and DER-encoded:</p>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Field</p></th>
<th scope="col" class="TableHeading_TableRow_TableCell"><p>Type</p></th>
<th scope="col" class="TableHeading_TableRow_TableCell"><p>Content</p></th></tr>

<tr><td  scope="row"><p>UDID</p></td>
<td ><p>String</p></td>
<td ><p>The device’s UDID.</p></td></tr>
<tr><td  scope="row"><p>SERIAL</p></td>
<td ><p>String</p></td>
<td ><p>The device’s serial number.</p></td></tr>
<tr><td  scope="row"><p>PRODUCT</p></td>
<td ><p>String</p></td>
<td ><p>The device’s product type: e.g., <code>iPhone5,1</code>.</p></td></tr>
<tr><td  scope="row"><p>VERSION</p></td>
<td ><p>String</p></td>
<td ><p>The OS version installed on the device: e.g., 7A182.</p></td></tr>
<tr><td  scope="row"><p>IMEI</p></td>
<td ><p>String</p></td>
<td ><p>The device’s IMEI (if available).</p></td></tr>
<tr><td  scope="row"><p>MEID</p></td>
<td ><p>String</p></td>
<td ><p>The device’s MEID (if available).</p></td></tr>
<tr><td  scope="row"><p>LANGUAGE</p></td>
<td ><p>String</p></td>
<td ><p>The user’s currently-selected language: e.g., <code>en</code>.</p></td></tr>
</table></div>
<p>The plist is CMS-signed with the device identity certificate. The device’s certificate and all necessary intermediate certificates are included. The certificate chain should validate against the Apple Root CA.</p>

<p>The server may respond with a 401 (Unauthorized) status message to prompt the user for a login. If this response is sent, the WWW-Authenticate header must contain the <code>Digest</code> authentication method. In iOS 7.1, the WWW-Authenticate header may also contain the <code>Basic</code> authentication method as outlined in RFC2617. When the user enters a username and password, the request is retried with the appropriate Authorization header.</p>
<p>If a 401 status is sent, the content of the response is shown above the prompt for the username and password. If the content is empty, a default message is displayed.</p>
<p>The server may respond with a 200 (OK) status to indicate a successful retrieval of the configuration profile. The configuration profile containing the MDM payload and one or more SCEP or certificate payloads must be included in the message body.</p>
</section>
<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW42" title="Remove Profile"></a><h5 class="jump">Remove Profile</h5><p>Removes profile mapping from the list of devices from Apple’s servers. After this call, the devices in the list will have no profiles associated with them. However, if those devices have already obtained the profile, this has no effect until the device is wiped and activated again.</p><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW43" title="URL"></a><h5 class="jump">URL</h5><p><code>https://mdmenrollment.apple.com/profile/devices</code></p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW44" title="Query Type"></a><h5 class="jump">Query Type</h5><p>DELETE</p></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW45" title="Request Body"></a><h5 class="jump">Request Body</h5><p>The request body should contain a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>Array of strings containing device serial numbers.</p></td></tr></table></div><p>For example, your MDM server might make the following request:</p><div class="codesample clear"><table><tr><td scope="row"><pre>DELETE /profile/devices HTTP/1.1<span></span></pre></td></tr><tr><td scope="row"><pre>User-Agent:ProfileManager-1.0<span></span></pre></td></tr><tr><td scope="row"><pre>X-Server-Protocol-Version:2<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 35<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices":["C8TJ500QF1MN", "B7CJ500QF1MA"]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW46" title="Response Body"></a><h5 class="jump">Response Body</h5><p>In response, the MDM enrollment service returns a JSON dictionary with the following keys:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Key</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Value</p></th></tr><tr><td  scope="row"><p><code>devices</code></p></td><td ><p>A dictionary of devices. Each key in this dictionary is the serial number of a device in the original request. Each value in this dictionary is one of the following strings:</p><ul class="threeHead"><li class="li"><p><code>SUCCESS</code>: Profile was removed from the device.</p></li><li class="li"><p><code>NOT_ACCESSIBLE</code>: A device with the specified serial number was not found.</p></li><li class="li"><p><code>FAILED</code>: Removing the profile failed for an unexpected reason. If three retries fail, the user should contact Apple support.</p></li></ul></td></tr></table></div><p>For example, the server might send a response that looks like this:</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 9 May 2013 03:24:28 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: application/json;charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>X-ADM-Auth-Session: 87a235815b8d6661ac73329f75815b8d6661ac73329f815<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 160<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Keep-Alive<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    "devices": {<span></span></pre></td></tr><tr><td scope="row"><pre>                  "C8TJ500QF1MN":"SUCCESS",<span></span></pre></td></tr><tr><td scope="row"><pre>                  "B7CJ500QF1MA":"NOT_ACCESSIBLE"<span></span></pre></td></tr><tr><td scope="row"><pre>               }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW47" title="Request-Specific Errors"></a><h5 class="jump">Request-Specific Errors</h5><p>In addition to the standard errors listed in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40017387-CH7-SW5" data-renderer-version="1">Common Error Codes</a></span>, this request can return the following errors:</p><ul class="ul"><li class="li"><p>A <code>400</code> error with <code>DEVICE_ID_REQUIRED</code> in the body of the response indicates that the request did not contain any device serial numbers.</p></li></ul></section></section>
</section>






</section>
</section>

<section><a name="//apple_ref/doc/uid/TP40017387-CH7-SW5" title="Common Error Codes"></a><h2 class="jump">Common Error Codes</h2><p>If the request could not be validated, the server returns one of the following errors.</p><ul class="ul"><li class="li"><p>An HTTP <code>400</code> error with <code>MALFORMED_REQUEST_BODY</code> in the response body indicates that the request body was not valid JSON.</p></li><li class="li"><p>An HTTP <code>401</code> error with <code>UNAUTHORIZED</code> in the response body indicates that the authentication token has expired. This error indicates that the MDM server should obtain a new auth token from the <span class="content_text"><a href="https://configbuddy.apple.com/session" class="urlLink" rel="external">https://mdmenrollment.apple.com/session</a></span> endpoint.</p></li><li class="li"><p>An HTTP <code>403</code> error with <code>FORBIDDEN</code> in the response body indicates that the authentication token is invalid.</p></li><li class="li"><p>An HTTP <code>405</code> error means that the method (query type) is not valid.</p></li></ul><p>For example, the following is the response when an authentication token has expired.</p><div class="codesample clear"><table><tr><td scope="row"><pre>HTTP/1.1 401 Unauthorized<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain;Charset=UTF8<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Length: 12<span></span></pre></td></tr><tr><td scope="row"><pre>Date: Thu, 31 May 2012 21:23:57 GMT<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: close<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>UNAUTHORIZED<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/TP40017387-CH7-SW73" title="Note"></a><p><strong>Note:</strong>&nbsp;The Device Enrollment Program service periodically issues a new <code>X-ADM-Auth-Session</code> in its response to a service call; the MDM server can use this new header value for any subsequent calls.</p><p></p></aside></div><p>After a period of extended inactivity, this token expires, and the MDM server must obtain a new auth token from the <span class="content_text"><a href="https://configbuddy.apple.com/session" class="urlLink" rel="external">https://mdmenrollment.apple.com/session</a></span> endpoint.</p><p>All responses may return a new <code>X-ADM-Auth-Session</code> token, which the MDM server should use in subsequent requests.</p></section>




        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='../5-Web_Service_Protocol_VPP/webservice.html'>Next</a><a class='previousLink' rel='prev' href='../3-MDM_Protocol/MDM_Protocol.html'>Previous</a>
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2018 Apple Inc. All Rights Reserved.  <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2018-06-04</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../../../../Resources/1282/JavaScript/lib/prototype.js"></script>
    <script src="../../../../../Resources/1282/JavaScript/library.js"></script>
</body>
</html>
